<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USDT Faucet | Telegram Mini App</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        /* ========================================= */
        /* CSS STİLLERİ */
        /* ========================================= */
        :root {
            --bg-light: #ffffff;
            --bg-card: #f8f9fa;
            --color-primary: #007bff;
            --color-success: #28a745;
            --color-danger: #dc3545; 
            --color-warning: #ffc107; 
            --color-text-dark: #343a40;
            --color-text-light: #6c757d;
            --border-color: #dee2e6;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--bg-light);
            color: var(--color-text-dark);
            margin: 0;
            padding: 0;
        }
        .container {
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        h2 {
            font-size: 1.8rem;
            color: var(--color-primary);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 10px;
            margin-top: 25px;
            margin-bottom: 25px;
        }
        .card {
            background-color: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }
        .main-balance { text-align: center; padding: 30px 20px; }
        .balance-label { color: var(--color-text-light); font-weight: 500; }
        .balance-amount { font-size: 3.5rem; font-weight: 700; color: var(--color-primary); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .stat-value { font-size: 1.5rem; font-weight: 700; margin-top: 5px; }
        .shortlink-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color); }
        .shortlink-item:last-child { border-bottom: none; }
        .link-reward { font-weight: 700; color: var(--color-success); }
        .btn-visit, .btn-success { padding: 8px 15px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center; gap: 8px; transition: opacity 0.2s; }
        .btn-visit { background-color: var(--color-primary); color: white; }
        .btn-success { background-color: var(--color-success); color: white; cursor: default; }
        .item-details { flex-grow: 1; }
        .item-details p { margin: 0; }
        .input-style { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 6px; box-sizing: border-box; color: var(--color-text-dark); background-color: var(--bg-light); }
        .btn-primary { background-color: var(--color-primary); color: white; padding: 10px 20px; border: none; border-radius: 6px; font-weight: 500; cursor: pointer; transition: background-color 0.2s; width: 100%; }
        .btn-primary:hover { background-color: #0056b3; }
        .disabled-item { opacity: 0.6; }
        
        /* Ana Sekme Navigasyonu */
        .tab-nav { display: flex; margin-bottom: 20px; border-bottom: 1px solid var(--border-color); overflow-x: auto; }
        .tab-nav button { flex-shrink: 0; background: none; border: none; padding: 10px 15px; cursor: pointer; font-size: 1rem; color: var(--color-text-light); border-bottom: 2px solid transparent; margin-right: 15px; font-weight: 500; }
        .tab-nav button.active { color: var(--color-primary); border-bottom: 2px solid var(--color-primary); font-weight: 700; }

        /* Admin Listeleri */
        .scrollable-list-container {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: var(--bg-card); 
            margin-top: 15px;
        }
        .admin-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid var(--border-color); }
        .admin-list-item:last-child { border-bottom: none; }
        .admin-list-item:hover { background-color: #e9ecef; }
        .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8rem; font-weight: 500; }
        .status-pending { background-color: var(--color-warning); color: var(--color-text-dark); }
        .status-paid { background-color: var(--color-success); color: white; }
        .status-rejected { background-color: var(--color-danger); color: white; }

        /* Admin Sekmeleri */
        .admin-tab-nav { display: flex; border-bottom: 1px solid var(--border-color); margin-bottom: 15px; overflow-x: auto; }
        .admin-tab-nav button { flex-shrink: 0; background: none; border: none; padding: 10px 15px; cursor: pointer; font-size: 0.9rem; color: var(--color-text-light); border-bottom: 2px solid transparent; margin-right: 10px; font-weight: 500; }
        .admin-tab-nav button.active { color: var(--color-danger); border-bottom: 2px solid var(--color-danger); font-weight: 700; }
    </style>
</head>
<body>

    <div class="container">
        
        <div class="card main-balance">
            <div class="balance-label">Total Balance (USD)</div>
            <div class="balance-amount" id="usd-balance">$0.00</div>
            <div style="font-size: 0.9rem; color: var(--color-text-light); margin-top: 5px;" id="crypto-value-label">~ 0.00000000 USDT</div>
        </div>

        <div class="tab-nav">
            <button class="active" onclick="showSection('dashboard', this)">Dashboard</button>
            <button onclick="showSection('shortlinks', this)">Shortlinks</button>
            <button onclick="showSection('withdraw', this)">Withdraw</button>
            <button id="admin-tab-btn" style="display:none; color:#dc3545;" onclick="showSection('admin', this)">Admin <i class="fas fa-tools"></i></button> 
        </div>

        <div id="dashboard-section" class="section">
            <div class="stats-grid">
                <div class="card"><div class="balance-label">Total Referrals</div><div class="stat-value" style="color: var(--color-primary);" id="total-referrals">0</div></div>
                <div class="card"><div class="balance-label">Referral Earnings</div><div class="stat-value" style="color: var(--color-success);" id="referral-earnings">$0.00</div></div>
            </div>
            <div class="card">
                <h2><i class="fas fa-users"></i> Invite Friends</h2>
                <input type="text" id="referralLink" class="input-style" readonly value="Loading...">
                <button class="btn-primary" onclick="copyReferralLink()"><i class="fas fa-copy"></i> Copy Link</button>
            </div>
        </div>

        <div id="shortlinks-section" class="section" style="display:none;">
             <div class="card">
                <h2><i class="fas fa-link"></i> Shortlinks</h2>
                <p style="color: var(--color-text-light); font-size: 0.9rem;">The reward is added instantly and securely (S2S Callback).</p>
                <div id="shortlink-list"></div>
            </div>
        </div>
        
        <div id="withdraw-section" class="section" style="display:none;">
             <div class="card">
                <h2><i class="fas fa-wallet"></i> Withdraw USDT (MATIC)</h2>
                <p style="color: var(--color-text-light);">Current Balance: <strong style="color: var(--color-success);" id="withdraw-usd-balance">$0.00</strong></p>
                <p style="font-size: 0.9rem; color: var(--color-danger); font-weight: 500;">Minimum Withdrawal: $0.50 USD</p>
                
                <label style="display: block; margin-top: 15px; font-weight: 500;">USDT (MATIC - Polygon) Address:</label>
                <input type="text" id="usdtAddress" placeholder="0x..." class="input-style">
                
                <label style="display: block; font-weight: 500;">Amount to Withdraw (USD):</label>
                <input type="number" id="withdrawAmount" value="0.50" class="input-style" min="0.50">

                <button class="btn-primary" onclick="requestWithdrawal()"><i class="fas fa-paper-plane"></i> Submit Withdrawal Request</button>
            </div>
        </div>

        <div id="admin-section" class="section" style="display:none;">
            <h2><i class="fas fa-tools"></i> Admin Panel</h2>
            
            <div class="admin-tab-nav">
                <button class="active" onclick="showAdminSection('admin-shortlinks-tab', this)">Shortlink Ekle</button>
                <button onclick="showAdminSection('admin-withdrawals-tab', this)">Ödeme Talepleri</button>
                <button onclick="showAdminSection('admin-users-tab', this)">Kullanıcı Listesi</button>
            </div>
            
            <div id="admin-shortlinks-tab" class="admin-tab-content">
                <div class="card">
                    <h3>Yeni Shortlink Ekle (RTDB'ye Kayıt)</h3>
                    <label>Link Adı:</label>
                    <input type="text" id="linkName" class="input-style" placeholder="Daily Ad Link">
                    <label>Ziyaret Linki (Base URL):</label>
                    <input type="url" id="baseUrl" class="input-style" placeholder="https://shrtfly.com/xyz123">
                    <label>Ödül Miktarı (USD):</label>
                    <input type="number" id="rewardAmount" class="input-style" value="0.015" step="0.001">
                    <button class="btn-primary" onclick="addNewShortlink()"><i class="fas fa-plus"></i> Linki Oluştur ve Kaydet</button>
                </div>

                <div id="callback-result-card" class="card" style="display:none; border-left: 5px solid #ffc107;">
                    <h3>✅ Link RTDB'ye Kaydedildi!</h3>
                    <p style="color:var(--color-text-light);">BU URL'Yİ KOPYALAYIP Shortlink Platformunun S2S Postback/Callback ayarına YAPIŞTIRIN.</p>
                    <textarea id="finalCallbackUrlOutput" class="input-style" rows="4" readonly></textarea>
                    <button class="btn-primary" onclick="copyCallbackUrl()" style="width:auto;"><i class="fas fa-copy"></i> Kopyala</button>
                </div>
            </div>

            <div id="admin-withdrawals-tab" class="admin-tab-content" style="display:none;">
                <h3 style="color: var(--color-danger);">Bekleyen Ödeme Talepleri</h3>
                <div class="scrollable-list-container" id="admin-withdrawal-list">
                     <div style="padding: 15px; color: var(--color-text-light);">Yükleniyor...</div>
                </div>
            </div>

            <div id="admin-users-tab" class="admin-tab-content" style="display:none;">
                <h3>Tüm Kullanıcılar (Bakiye Sıralı)</h3>
                <div class="scrollable-list-container" id="admin-user-list">
                     <div style="padding: 15px; color: var(--color-text-light);">Yükleniyor...</div>
                </div>
            </div>
            
        </div>
        
    </div>

    <script>
        // =======================================================
        // KRİTİK KONFİGÜRASYONLAR (LÜTFEN DEĞİŞTİRİN)
        // =======================================================
        const FIREBASE_API_KEY = 'AIzaSyCy1QPNWqd3nPnuECNRNNPtfNTOzq_0MxM'; 
        const RTDB_URL = 'https://shrtlinkearner-default-rtdb.firebaseio.com'; 
        const MIN_WITHDRAWAL = 0.50; 
        
        // !!! DEPLOY SONRASI GİRİLMESİ GEREKEN GERÇEK URL'LER !!!
        const ADD_LINK_FUNCTION_URL = 'YOUR_ADD_LINK_FUNCTION_URL'; 
        const CALLBACK_BASE_URL = 'YOUR_FIREBASE_CALLBACK_URL'; 
        const WITHDRAW_FUNCTION_URL = 'YOUR_WITHDRAW_FUNCTION_URL'; 
        const ADMIN_GET_DATA_FUNCTION_URL = 'YOUR_ADMIN_GET_DATA_FUNCTION_URL'; // Cloud Function URL'si

        // SİZİN TELEGRAM ID'NİZ (LÜTFEN KONTROL EDİN VE DEĞİŞTİRİN)
        const ADMIN_IDS = ['7904032877']; 

        // =======================================================
        // GLOBAL DURUM VE CORE FONKSİYONLAR
        // =======================================================
        let userId = '999999999'; // Varsayılan ID
        let userCompletedLinks = {};
        let shortlinksData = {};
        let currentUsdBalance = 0.00;
        let totalReferrals = 0;
        let referralEarnings = 0.00;
        let activeSection = 'dashboard';
        let activeAdminTab = 'admin-shortlinks-tab';

        document.addEventListener('DOMContentLoaded', initializeMiniApp);

        function initializeMiniApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const webApp = window.Telegram.WebApp;
                webApp.ready();
                
                // ID'yi kesin olarak string formatında almaya çalışıyoruz
                if (webApp.initDataUnsafe && webApp.initDataUnsafe.user && webApp.initDataUnsafe.user.id) {
                    userId = webApp.initDataUnsafe.user.id.toString(); 
                } 
                
                webApp.MainButton.setText("Refresh Balance").show().onClick(fetchData);
                document.body.style.backgroundColor = webApp.themeParams.bg_color || 'var(--bg-light)';
                
                // ADMIN KONTROLÜ VE BUTON GÖRÜNÜRLÜĞÜ
                if (ADMIN_IDS.includes(userId)) {
                    document.getElementById('admin-tab-btn').style.display = 'inline-block';
                    console.log(`Admin butonu etkinleştirildi! ID: ${userId}`);
                } else {
                    document.getElementById('admin-tab-btn').style.display = 'none';
                    console.log(`Admin butonu gizli. Kullanıcı ID: ${userId}`);
                }
                
                fetchData(); 
                setInterval(fetchData, 10000); 
            } else {
                 fetchData();
            }
        }

        async function fetchData() {
            // ... (veri çekme mantığı aynı) ...
            try {
                const userResponse = await fetch(`${RTDB_URL}/users/${userId}.json?auth=${FIREBASE_API_KEY}`);
                const userData = await userResponse.json();

                if (userData) {
                    currentUsdBalance = userData.balance || 0;
                    totalReferrals = userData.referrals || 0;
                    referralEarnings = userData.referral_earnings || 0;
                    userCompletedLinks = userData.completed_links || {};
                }

                const linksResponse = await fetch(`${RTDB_URL}/shortlinks.json?auth=${FIREBASE_API_KEY}`);
                shortlinksData = await linksResponse.json();
                
                updateAllBalances();
                
                if (ADMIN_IDS.includes(userId) && activeSection === 'admin') {
                    // Admin sekmesi aktifse, sadece ilgili sekmeyi güncelle
                    fetchAdminData(activeAdminTab);
                }
            } catch (error) {
                console.error("Veri çekme hatası:", error);
            }
        }

        function updateAllBalances() {
             document.getElementById('usd-balance').textContent = `$${currentUsdBalance.toFixed(4)}`;
             document.getElementById('crypto-value-label').textContent = `~ ${currentUsdBalance.toFixed(8)} USDT`;
             document.getElementById('total-referrals').textContent = totalReferrals;
             document.getElementById('referral-earnings').textContent = `$${referralEarnings.toFixed(4)}`;
             document.getElementById('referralLink').value = `https://t.me/your_bot_name?start=${userId}`;
             document.getElementById('withdraw-usd-balance').textContent = `$${currentUsdBalance.toFixed(4)}`;
             
             if(activeSection === 'shortlinks') {
                 renderShortlinks();
             }
        }
        
        // ... (renderShortlinks ve closeMiniAppOnVisit aynı kalır) ...
        function renderShortlinks() { 
            const listEl = document.getElementById('shortlink-list');
            listEl.innerHTML = '';
            
            if (!shortlinksData || Object.keys(shortlinksData).length === 0) {
                 listEl.innerHTML = `<div class="card" style="color: var(--color-text-light);">Aktif shortlink bulunamadı.</div>`;
                 return;
            }

            Object.entries(shortlinksData).forEach(([linkId, linkData]) => {
                const isPassed = userCompletedLinks[linkId] === true; 
                const finalVisitUrl = `${linkData.base_url}?sub_id=${userId}`; 

                const itemHtml = `
                    <div class="shortlink-item ${isPassed ? 'disabled-item' : ''}">
                        <div class="item-details">
                            <p style="font-weight: 500;">${linkData.name}</p>
                            <p style="font-size: 0.8rem; color: var(--color-text-light);">Link ID: ${linkId}</p>
                        </div>
                        <div class="link-reward">
                            +$${linkData.reward.toFixed(3)}
                        </div>
                        <div style="margin-left: 15px;">
                            ${isPassed 
                                ? `<button class="btn-success"><i class="fas fa-check"></i> Tamamlandı</button>`
                                : `<a href="${finalVisitUrl}" target="_blank" class="btn-visit" onclick="closeMiniAppOnVisit();">
                                     <i class="fas fa-external-link-alt"></i> Ziyaret Et
                                   </a>`
                            }
                        </div>
                    </div>
                `;
                listEl.innerHTML += itemHtml;
            });
        }
        
        function closeMiniAppOnVisit() {
             if (window.Telegram && window.Telegram.WebApp) {
                 window.Telegram.WebApp.close();
             }
        }

        // =======================================================
        // WITHDRAWAL FUNCTIONS (GERÇEK İSTEK)
        // =======================================================
        async function requestWithdrawal() {
             const amount = parseFloat(document.getElementById('withdrawAmount').value);
             const address = document.getElementById('usdtAddress').value.trim();
             
             if(amount < MIN_WITHDRAWAL) {
                 window.Telegram.WebApp.showAlert(`Minimum çekim $${MIN_WITHDRAWAL.toFixed(2)} USD'dir.`); return;
             }
             if(amount > currentUsdBalance) {
                 window.Telegram.WebApp.showAlert("Yetersiz bakiye!"); return;
             }
             if(address.length < 20 || !address.startsWith('0x')) {
                 window.Telegram.WebApp.showAlert("Geçersiz USDT (MATIC) adresi!"); return;
             }
             
             window.Telegram.WebApp.MainButton.setText("Talebiniz Gönderiliyor...").show().disable();
             
             try {
                const response = await fetch(WITHDRAW_FUNCTION_URL, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        data: { userId: userId, amount: amount, address: address, currency: 'USDT_MATIC' }
                    })
                });
                
                const result = await response.json();
                
                if (result.data && result.data.status === 'success') {
                    window.Telegram.WebApp.showAlert("Çekim talebiniz başarıyla oluşturuldu ve işlenmeyi bekliyor.");
                    fetchData(); 
                } else {
                    window.Telegram.WebApp.showAlert(`Hata: ${result.error?.message || 'Çekim isteği sunucudan reddedildi.'}`);
                }
             } catch (e) {
                 window.Telegram.WebApp.showAlert("Çekim talebi gönderilemedi. Sunucu bağlantı hatası.");
             } finally {
                window.Telegram.WebApp.MainButton.setText("Refresh Balance").enable();
             }
        }


        // =======================================================
        // ADMIN PANELİ FONKSİYONLARI
        // =======================================================
        
        function showAdminSection(tabId, element) {
            activeAdminTab = tabId;
            document.querySelectorAll('.admin-tab-content').forEach(section => {
                section.style.display = 'none';
            });
            document.getElementById(tabId).style.display = 'block';

            document.querySelectorAll('.admin-tab-nav button').forEach(button => {
                button.classList.remove('active');
            });
            element.classList.add('active');
            
            fetchAdminData(tabId);
        }
        
        async function fetchAdminData(tabId) {
            if (!ADMIN_IDS.includes(userId)) return;

            const listEl = document.getElementById(tabId.replace('-tab', '-list'));
            if (!listEl) return;
            
            // Eğer kısa link ekleme sekmesiyse listeyi yenileme
            if (tabId === 'admin-shortlinks-tab') return;
            
            listEl.innerHTML = `<div style="padding: 15px; color: var(--color-primary);"><i class="fas fa-spinner fa-spin"></i> Veriler yükleniyor...</div>`;

            try {
                const dataType = tabId === 'admin-withdrawals-tab' ? 'withdrawals' : 'users';
                
                const response = await fetch(ADMIN_GET_DATA_FUNCTION_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: { dataType: dataType, adminId: userId } }) 
                });
                
                const result = await response.json();
                const data = result.data.list || {};

                if (dataType === 'withdrawals') {
                    renderWithdrawals(data);
                } else if (dataType === 'users') {
                    renderUsers(data);
                }
            } catch (e) {
                listEl.innerHTML = `<div style="padding: 15px; color: var(--color-danger);">Hata: Admin verileri çekilemedi. URL'yi kontrol edin.</div>`;
                console.error("Admin data fetch error:", e);
            }
        }

        function renderWithdrawals(withdrawals) {
            const listEl = document.getElementById('admin-withdrawal-list');
            listEl.innerHTML = '';
            
            if (Object.keys(withdrawals).length === 0) {
                 listEl.innerHTML = `<div style="padding: 15px; color: var(--color-text-light);">Bekleyen veya tamamlanmış ödeme talebi yok.</div>`;
                 return;
            }
            
            Object.entries(withdrawals).forEach(([id, item]) => {
                const statusClass = item.status === 'Paid' ? 'status-paid' : item.status === 'Rejected' ? 'status-rejected' : 'status-pending';
                const itemHtml = `
                    <div class="admin-list-item">
                        <div>
                            <span style="font-weight: 500; color: ${item.status === 'Pending' ? 'var(--color-danger)' : 'var(--color-text-dark)'};">$${(item.amount || 0).toFixed(2)} USD</span>
                            <p style="font-size: 0.8rem; color: var(--color-text-light); margin: 2px 0;">UID: ${item.uid} | Adres: ${item.address.substring(0, 8)}...</p>
                        </div>
                        <span class="status-badge ${statusClass}">${item.status}</span>
                    </div>
                `;
                listEl.innerHTML += itemHtml;
            });
        }
        
        function renderUsers(users) {
             const listEl = document.getElementById('admin-user-list');
             listEl.innerHTML = '';
             
             if (Object.keys(users).length === 0) {
                 listEl.innerHTML = `<div style="padding: 15px; color: var(--color-text-light);">Kayıtlı kullanıcı yok.</div>`;
                 return;
             }

             const sortedUsers = Object.entries(users).sort(([, a], [, b]) => (b.balance || 0) - (a.balance || 0));

             sortedUsers.forEach(([uid, user]) => {
                 const itemHtml = `
                     <div class="admin-list-item">
                         <div>
                             <span style="font-weight: 500;">UID: ${uid}</span>
                             <p style="font-size: 0.8rem; color: var(--color-text-light); margin: 2px 0;">Bakiye: $${(user.balance || 0).toFixed(4)} | Ref: ${user.referrals || 0}</p>
                         </div>
                         <span style="font-size: 0.9rem; color: var(--color-primary);">${(user.balance || 0) >= MIN_WITHDRAWAL ? 'Çekim Hazır' : 'Yetersiz'}</span>
                     </div>
                 `;
                 listEl.innerHTML += itemHtml;
             });
        }


        // ... (addNewShortlink, copyCallbackUrl, copyReferralLink ve showSection fonksiyonları aynı kalır) ...
        async function addNewShortlink() {
            if (!ADMIN_IDS.includes(userId)) { window.Telegram.WebApp.showAlert("Yetkisiz işlem!"); return; }
            const name = document.getElementById('linkName').value;
            const baseUrl = document.getElementById('baseUrl').value;
            const reward = document.getElementById('rewardAmount').value;

            if (!name || !baseUrl || isNaN(parseFloat(reward)) || parseFloat(reward) <= 0) {
                window.Telegram.WebApp.showAlert("Lütfen tüm alanları doğru doldurun."); return;
            }
            document.getElementById('callback-result-card').style.display = 'none';
            window.Telegram.WebApp.MainButton.setText("Oluşturuluyor...").show().disable();

            try {
                const dataToSend = { name: name, base_url: baseUrl, reward: reward, callback_base_url: CALLBACK_BASE_URL, userId: userId };
                const response = await fetch(ADD_LINK_FUNCTION_URL, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: dataToSend }) 
                });
                const result = await response.json();
                
                if (result.data && result.data.status === 'success') {
                    document.getElementById('finalCallbackUrlOutput').value = result.data.finalCallbackUrl;
                    document.getElementById('callback-result-card').style.display = 'block';
                    window.Telegram.WebApp.showAlert(`Shortlink başarıyla kaydedildi! ID: ${result.data.linkId}`);
                    fetchData(); 
                } else {
                    window.Telegram.WebApp.showAlert(`Hata: ${result.error?.message || 'Link eklenirken sunucu hatası.'}`);
                }
            } catch (error) {
                window.Telegram.WebApp.showAlert("Sunucuya bağlanılamadı. URL'leri kontrol edin.");
            } finally {
                window.Telegram.WebApp.MainButton.setText("Refresh Balance").enable();
            }
        }
        
        function copyCallbackUrl() {
            const textarea = document.getElementById('finalCallbackUrlOutput');
            textarea.select();
            textarea.setSelectionRange(0, 99999); 
            navigator.clipboard.writeText(textarea.value);
            window.Telegram.WebApp.showAlert("Callback URL panoya kopyalandı!");
        }

        function copyReferralLink() {
            const linkInput = document.getElementById('referralLink');
            linkInput.select();
            linkInput.setSelectionRange(0, 99999); 
            navigator.clipboard.writeText(linkInput.value);
            window.Telegram.WebApp.showPopup({message: 'Referans linki panoya kopyalandı!'});
        }

        function showSection(sectionId, element) {
            activeSection = sectionId;
            document.querySelectorAll('.section').forEach(section => { section.style.display = 'none'; });
            document.getElementById(`${sectionId}-section`).style.display = 'block';
            document.querySelectorAll('.tab-nav button').forEach(button => { button.classList.remove('active'); });
            element.classList.add('active');
            
            if (sectionId === 'shortlinks') { renderShortlinks(); } 
            else if (sectionId === 'admin' && ADMIN_IDS.includes(userId)) {
                 const defaultTabButton = document.querySelector('.admin-tab-nav button.active');
                 if (defaultTabButton) {
                     // Sekme ID'sini al ve admin verisini çek
                     const tabIdMatch = defaultTabButton.getAttribute('onclick').match(/'([^']+)'/);
                     if (tabIdMatch) {
                         showAdminSection(tabIdMatch[1], defaultTabButton);
                     }
                 }
            }
        }
        
        // Başlangıçta tüm bölümleri gizle
        document.getElementById('shortlinks-section').style.display = 'none';
        document.getElementById('withdraw-section').style.display = 'none';
        document.getElementById('admin-section').style.display = 'none';
        
    </script>
</body>
</html>
